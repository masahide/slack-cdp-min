# 4.4 サマリ生成フロー & 編集 UI TDDタスクリスト

## 0. テスト基盤の整備
- [ ] RED: `apps/browser` の Svelte コンポーネントを Vitest + `@testing-library/svelte` で検証できるセットアップを追加し、未完成のままテストが失敗することを確認する。
- [ ] GREEN: テスト基盤が動作するように最小限の設定とダミーコンポーネントを実装する。
- [ ] REFACTOR: テスト用ヘルパーとモック（サマリ JSONL 読み込み、LLM API スタブ）を共通化し、フィクスチャ生成関数を `tests/helpers` へ切り出す。

## 1. サマリ作成ボタン起点のフロー
- [ ] RED: `/day/<date>` 画面で「サマリを作成」ボタン押下時にフェッチ呼び出しとストア更新が起きることを検証する失敗テストを書く。
- [ ] GREEN: ボタンを実装し、既存サマリの存在チェックと新規生成要求（4.1 パイプライン呼び出し）までを通す。
- [ ] REFACTOR: 日付別データアクセスをサービス層に抽出し、テストでファイルシステム依存を外せるようにする。

## 2. 3ペインレイアウトの骨組み
- [ ] RED: LLMチャット／編集／プレビューの 3 ペインが初期レンダリングされることを検証するスナップショットまたはロールテストを作成し、未実装で失敗させる。
- [ ] GREEN: 3 カラムレイアウトを Svelte コンポーネントで実装し、スタブデータで各ペインが描画されるようにする。
- [ ] REFACTOR: レイアウトスタイルを共通 CSS モジュールへ移し、レスポンシブ要件をユニットテストから独立した Storybook/Playwright のビジュアル回帰準備に繋げる。

## 3. LLM チャットウィンドウ機能
- [ ] RED: モデル選択・テキスト選択送信・差分プレビューの挙動をモック API で検証する失敗テストを書く。
- [ ] GREEN: モデル一覧を `reaclog.config.json` から読み込むストアと、モック API を使った差分表示ロジックを実装する。
- [ ] REFACTOR: 差分適用処理を純関数化し、ユニットテストで置き換え／追記／キャンセルの分岐網羅を行う。

## 4. 編集ウィンドウ
- [ ] RED: Markdown 編集テキストエリアが `Cmd/Ctrl+S` と `Cmd/Ctrl+Enter` のショートカットを発火し、500ms デバウンスでストア更新することを検証する失敗テストを書く。
- [ ] GREEN: 実装を追加し、ショートカット時のイベント発火とストア同期がテストで通るようにする。
- [ ] REFACTOR: 入力ハンドラをカスタムフックへ分離し、他コンポーネントからも再利用できるようにする。

## 5. プレビューウィンドウ
- [ ] RED: 編集ストアの更新に応じて 300–500ms デバウンスで HTML が再レンダリングされることを確認する失敗テストを追加する。
- [ ] GREEN: `marked` 等を用いた Markdown → HTML 変換とスクロール同期の最小実装を行う。
- [ ] REFACTOR: レンダリングパイプラインをワーカー化する準備として、変換処理を別モジュールへ抽出し副作用を局所化する。

## 6. 保存と下書き管理
- [ ] RED: 保存アクションが `<dataDir>/YYYY/MM/DD/summaries/daily.md` への書き出しとトースト通知を呼び出すこと、離脱前に確認ダイアログが出ることを検証する失敗テストを書く。
- [ ] GREEN: ファイル永続化 API（モック）とトースト表示、離脱ガードを実装する。
- [ ] REFACTOR: 保存結果のタイムスタンプ表示をストアに保持し、再利用しやすいフォーマット関数を共通化する。

## 7. 回帰テストとリグレッション防止
- [ ] RED: 主要ユーザーフロー（サマリ読込→編集→LLM 助言→保存）の E2E シナリオを Playwright などで記述し、現状は失敗することを確認する。
- [ ] GREEN: 実装完了後に E2E シナリオが通過することを確認し、CI へ組み込む。
- [ ] REFACTOR: テストデータのリセットとモック API のライフサイクル管理を共通ユーティリティにまとめ、将来の機能追加時にテスト拡張しやすくする。
